
<!DOCTYPE html>
<html>
<head>
	<title>WeCare</title>
	<link rel="stylesheet" href="css/global.css" type="text/css">
    <meta charset="utf-8">
    <link rel="shortcut icon" href="#" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script>

        
    var myTable; // use a global for the submit and return data rendering in the examples    
    function loadTable()
    {
        $.ajax({
            url: '/work',
            method: 'get',
            dataType: 'json',
            success: function (data){
                myTable =  $('#workTable').DataTable( {
                        dom: 'Bfrtip',  
                        data: data,                         
                        columns: [
                            {data: "WorkId"},
                            {data: "WorkDesc"},
                            {data: "date"},
                            {data: "email"},
                            {data: "carnumber"},
                            {
                                data: null,
                                className: "center",
                                defaultContent: '<a href="/Log" class="editor_edit">Edit</a> / <a href="" class="editor_remove">Delete</a>'
                            }
                        ]
                        
                }); 
            }
        });
    }
    $(document).ready(function() {
               
        loadTable();
         // Edit record
        $('#workTable').on('click', 'a.editor_edit', function (e) {
            e.preventDefault();
            if($(this).context.innerHTML=="Edit")
            {
                $(this).context.innerText ="Save";
                var $row = $(this).closest("tr");
                var $tdElement = $row.find("td")[1];
                var txt = $tdElement.innerHTML;
                $tdElement.innerHTML = "<input style='width:100%;background-color: rgba(255, 255, 128, .5);' type='text' value='" + txt + "'>";
            }
            else{
                $(this).context.innerText ="Edit";
                var $row = $(this).closest("tr");
                var $tdElement = $row.find("td")[1];
                var id = $row.find("td")[0].innerHTML;
                var workDesc = $row.find("td").find("input").first().val();
                var json = {
                    'id': id,
                    'workDesc': workDesc
                }
                $.ajax({
                    url: '/work/',
                    type: 'PUT',
                    data: json,
                    success: function(result) {
                        $tdElement.innerHTML = workDesc
                    }
                });
            }
       } );
 
        // Delete a record
        $('#workTable').on('click', 'a.editor_remove', function (e) {
            e.preventDefault();
            
            var answer = confirm("Do you want to delete selected item?")
            if (answer) {
                var $row = $(this).closest("tr");
                var id = $row.find("td")[0].innerHTML;
                $(this).closest('tr').remove();
                $.ajax({
                    url: '/work/'+id,
                    type: 'DELETE',
                    success: function(result) {
                        myTable.destroy();
                        loadTable();
                    }
                });
            }
        } );
        $('#AddTreatmentBtn').on('click', addWork);
    });
    //add work to DB 
    function addWork(){
        var carnumber = $('#inputOwnerCarNumber').val();
        var treatmentinfo = $('#inputTreatmentInformation').val();
        
        var json = {
          'workDesc': treatmentinfo,
          'carnumber': carnumber
        }
       
            var response = $.post('/work', json);
            response.done(function(){
                myTable.destroy();
                loadTable();
            });
        }
   

	     
    </script>
</head>
<body>
    <nav class="navbar navbar-togglseable-md navbar-light bg-faded fixed-top " style="background-color: #fff" id="page_nav">
        <a href="/" class="navbar-brand  mx-auto" >
            <div class="vipTarderFxLogo"  ><span>We</span><span>Care</span>
            </div>
        </a>
    </nav>
	<div class="container-fluid" style="background: rgba(255,255,255, 0.8);box-shadow: 0 0 10px 4px rgba(0,0,0,0.2) ;">
            <div class="row">
                <div class="col-md-2 col-sm-2 col-xs-4">
                    <div class="form--container" >
                        <h1 class="LognRegister">Insert New Treatment Information</h1>	
                        </div>
                        <div class="form-group">
                            <label for="inputOwnerCarNumber">Car Plate Number</label>
                            <div class="input-group input-group">
                                <textarea  rows="1" cols="20"type="OwnerCarNumber" class="form-control" id="inputOwnerCarNumber" placeholder="Plate Number" style="resize: none;""></textarea>
                            </div>	
                            
                        </div>
                        <div class="form-group">
                            <label for="inputTreatmentInformation">Treatment Information</label>
                            <div class="input-group input-group">
                                <textarea rows="4" cols="74" type="TreatmentInformation" class="form-control" id="inputTreatmentInformation" placeholder="Treatment information" style="resize: none;"></textarea>
                            </div>
                        </div>
                        <button id="AddTreatmentBtn" class="btn btn-primary btn-block" >Add Treatment</button>
                    </div>


                <div class="col-xs-8">
                <br><br>
                    <div class="table-cont" id="table-cont"> 
                            <table class="table table-bordered table-striped" id="workTable" >
                                <thead>
                                    <tr class=" bg-primary">
                                        <th scope="col">Treatment Number</th>
                                        <th scope="col">Treatment Information</th>
                                        <th scope="col"> Date</th>
                                        <th scope="col">Worker email</th>
                                        <th scope="col">Car Number</th>
                                        <th scope="col">Action</th>
                                    </tr>
                                </thead>
                            </table>
                </div>
            </div>
    	</div>
    </div>





		<footer class="footer">
		  <p>Contact Support: <a href="mailto:ServerClientProjectBraude@gmail.com">support@wecare.com</a></p>
		  <p>Â© 2019 WeCare.  All rights reserved</p>
		</footer>
</body>


</html>
